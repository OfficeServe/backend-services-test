machine:

  # pre:
  #   - git clone git@github.com:OfficeServe/sbt-settings.git
  #   - chmod +x sbt-settings/./circleBuildScript.sh
  #   - sbt-settings/./circleBuildScript.sh machine_pre
  timezone: UTC
  java:
    version: oraclejdk8
  services:
    - docker

# Collect build artifacts
general:
  artifacts:
    - target/universal

dependencies:
  # Cache the resolution-cache and build streams to speed things up
  pre:
    - wget -q https://dl.bintray.com/sbt/debian/sbt-0.13.13.deb
    - sudo dpkg -i sbt-0.13.13.deb
    # Installing docker-compose / needed for permission issue to install pip
    #- curl -sSL https://s3.amazonaws.com/circle-downloads/install-circleci-docker.sh | bash -s -- 1.10.0
    #- sudo pip install --upgrade pip
    #- sudo pip install docker-compose
    - curl -L https://github.com/docker/compose/releases/download/1.6.2/docker-compose-`uname -s`-`uname -m` > ~/docker-compose
    - chmod +x ~/docker-compose
    - ~/docker-compose up -d
  cache_directories:
    - "~/.ivy2"
    - "~/.sbt"
  override:
    # - sbt clean test:compile
    - sbt clean test:compile

test:
  override:
    # - ../sbt-settings/circleBuildScript.sh run_tests && sbt it:test
    - sbt clean test package
    #- sbt compile it:test
  # Copy test reports to Circle test reports dir then package app for deploy
  # post:
  #   - cd .. ; sbt-settings/./circleBuildScript.sh copy_test_report
